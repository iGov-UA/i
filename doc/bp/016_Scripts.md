
1. [Форматирование даты в процессе](https://github.com/e-government-ua/iBP/wiki/%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B/_edit#%D0%A4%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B4%D0%B0%D1%82%D1%8B-%D0%B2-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%B5)  
1. [Получение даты/времени на нужном этапе процесса](https://github.com/e-government-ua/iBP/wiki/%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B/_edit#%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%B0%D1%82%D1%8B%D0%B2%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%B8-%D0%BD%D0%B0-%D0%BD%D1%83%D0%B6%D0%BD%D0%BE%D0%BC-%D1%8D%D1%82%D0%B0%D0%BF%D0%B5-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%B0)  
1. [Получение даты/времени напоминания о выбранной дате из электронной очереди](https://github.com/e-government-ua/iBP/wiki/%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B/_edit#%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B4%D0%B0%D1%82%D1%8B%D0%B2%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%B8-%D0%BD%D0%B0%D0%BF%D0%BE%D0%BC%D0%B8%D0%BD%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BE-%D0%B2%D1%8B%D0%B1%D1%80%D0%B0%D0%BD%D0%BD%D0%BE%D0%B9-%D0%B4%D0%B0%D1%82%D0%B5-%D0%B8%D0%B7-%D1%8D%D0%BB%D0%B5%D0%BA%D1%82%D1%80%D0%BE%D0%BD%D0%BD%D0%BE%D0%B9-%D0%BE%D1%87%D0%B5%D1%80%D0%B5%D0%B4%D0%B8)
1. [Вычисление любой даты до (для напоминания) или после (для удаления заявки) даты визита](https://github.com/e-government-ua/iBP/wiki/%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B/_edit#%D0%92%D1%8B%D1%87%D0%B8%D1%81%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BB%D1%8E%D0%B1%D0%BE%D0%B9-%D0%B4%D0%B0%D1%82%D1%8B-%D0%B4%D0%BE-%D0%B4%D0%BB%D1%8F-%D0%BD%D0%B0%D0%BF%D0%BE%D0%BC%D0%B8%D0%BD%D0%B0%D0%BD%D0%B8%D1%8F-%D0%B8%D0%BB%D0%B8-%D0%BF%D0%BE%D1%81%D0%BB%D0%B5-%D0%B4%D0%BB%D1%8F-%D1%83%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B7%D0%B0%D1%8F%D0%B2%D0%BA%D0%B8-%D0%B4%D0%B0%D1%82%D1%8B-%D0%B2%D0%B8%D0%B7%D0%B8%D1%82%D0%B0)  
1. [Удаление конкретного слота за продолжителный период](https://github.com/e-government-ua/iBP/wiki/%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B#%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BA%D0%BE%D0%BD%D0%BA%D1%80%D0%B5%D1%82%D0%BD%D0%BE%D0%B3%D0%BE-%D1%81%D0%BB%D0%BE%D1%82%D0%B0-%D0%B7%D0%B0-%D0%BF%D1%80%D0%BE%D0%B4%D0%BE%D0%BB%D0%B6%D0%B8%D1%82%D0%B5%D0%BB%D0%BD%D1%8B%D0%B9-%D0%BF%D0%B5%D1%80%D0%B8%D0%BE%D0%B4)  
1. [Формирование динамического списка документов (для принтформ)](https://github.com/e-government-ua/iBP/wiki/%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B/_edit#%D0%A4%D0%BE%D1%80%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B4%D0%B8%D0%BD%D0%B0%D0%BC%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%BE%D0%B2-%D0%B4%D0%BB%D1%8F-%D0%BF%D1%80%D0%B8%D0%BD%D1%82%D1%84%D0%BE%D1%80%D0%BC)  
1. [Получение ИД текущего процесса](https://github.com/e-government-ua/iBP/wiki/%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B/_edit#%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%98%D0%94-%D1%82%D0%B5%D0%BA%D1%83%D1%89%D0%B5%D0%B3%D0%BE-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%B0)  
1. [Формирование динамического названия юзертаски](https://github.com/e-government-ua/iBP/wiki/%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B/_edit#%D0%A4%D0%BE%D1%80%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B4%D0%B8%D0%BD%D0%B0%D0%BC%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-%D0%BD%D0%B0%D0%B7%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D1%8E%D0%B7%D0%B5%D1%80%D1%82%D0%B0%D1%81%D0%BA%D0%B8)  
1. [Счетчик добавления номера в поле входящего номера](https://github.com/e-government-ua/iBP/wiki/%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B/_edit#%D0%A1%D1%87%D0%B5%D1%82%D1%87%D0%B8%D0%BA-%D0%B4%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BD%D0%BE%D0%BC%D0%B5%D1%80%D0%B0-%D0%B2-%D0%BF%D0%BE%D0%BB%D0%B5-%D0%B2%D1%85%D0%BE%D0%B4%D1%8F%D1%89%D0%B5%D0%B3%D0%BE-%D0%BD%D0%BE%D0%BC%D0%B5%D1%80%D0%B0)  
1. [Счетчик добавления номера в поле входящего номера](https://github.com/e-government-ua/iBP/wiki/%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B/_edit#%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%B0%D1%82%D1%8B-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F---%D0%BF%D0%BE-%D1%83%D0%BC%D0%BE%D0%BB%D1%87%D0%B0%D0%BD%D0%B8%D1%8E--30-%D0%B4%D0%BD%D0%B5%D0%B9-%D0%BA-%D1%82%D0%B5%D0%BA%D1%83%D1%89%D0%B5%D0%B9-%D0%B4%D0%B0%D1%82%D1%8B-%D0%B8-%D0%BF%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4-%D0%B4%D0%B0%D1%82%D1%8B-%D0%B2-%D0%BD%D1%83%D0%B6%D0%BD%D1%8B%D0%B9-%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82-%D0%B4%D0%B4%D0%BC%D0%BC%D0%B3%D0%B3%D0%B3%D0%B3)  
1. [Получение ИД БП](https://github.com/e-government-ua/iBP/wiki/%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B/_edit#%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%98%D0%94-%D0%91%D0%9F)  
1. [Получение логина и ФИО основного исполнителя (человека которого в таблице выбрали первым)](https://github.com/e-government-ua/iBP/wiki/%D0%A1%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B/_edit#%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BB%D0%BE%D0%B3%D0%B8%D0%BD%D0%B0-%D0%B8-%D0%A4%D0%98%D0%9E-%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D0%BE%D0%B3%D0%BE-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D0%B5%D0%BB%D1%8F-%D1%87%D0%B5%D0%BB%D0%BE%D0%B2%D0%B5%D0%BA%D0%B0-%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D0%BE%D0%B3%D0%BE-%D0%B2-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B5-%D0%B2%D1%8B%D0%B1%D1%80%D0%B0%D0%BB%D0%B8-%D0%BF%D0%B5%D1%80%D0%B2%D1%8B%D0%BC)  



execution.getVariable('var1') - обращение к переменной var1 для получения её значения  
execution.setVariable('var2', value) - запись  значения value в переменную var2  

Пример 1:  
```javaScript 
<scriptTask id="scripttask1" name="Script Task" scriptFormat="javascript" activiti:autoStoreVariables="false">
  <script>
    var result = ' new value '
    if(execution.getVariable('var1') == 'value'){
    execution.setVariable('var2', result)}
  </script>
</scriptTask>
```
Пример 2.  
**Cохранить текущее значение даты в переменную MyDateToday**
```javaScript 
<scriptTask id="scripttask1" name="Script Task" scriptFormat="groovy" activiti:autoStoreVariables="false">
  <script>
    execution.setVariable('MyDateToday', new Date().format("dd.MM.yyyy").toString())
  </script>
</scriptTask>
```

[описание операторов и переменных для написания скриптов Javascript](http://javascript.ru/)  

Для получения значения даты на момент срабатывания скрипта можно использовать:
```javaScript
var unixdate= Math.round((new Date()).getTime())   // в формате UNIX
```
и далее работать с этим числом, прибавляя-отнимая время в милисекундах



***

## Форматирование даты в процессе.
Создать скрипт-таску, в main-config задать: script lang - “groovy”
```groovy
execution.setVariable("docDateFormat", execution.getVariable("docDate").format("yyyy-MM-dd"))
```
где  
**docDate** - имя параметра даты в процессе с форматом типа date.  Дата выбиралась из календарика.  
**yyyy-MM-dd** - итоговый требуемый формат даты.  регистрозависимо!!!   
**docDateFormat** - переменная, где сохранится  дата уже в необходимом указанном формате.  

***

## Получение даты/времени на нужном этапе процесса
надо создать скрипт groovy, а во второй аргумент функции  setVariable вписать создание объекта Date с ключевым словом new.
В общем скрипт будет выглядеть вот так:
```xml
<scriptTask id="scripttask1" name="Script Task" scriptFormat="groovy" activiti:autoStoreVariables="false">
  <script>
  execution.setVariable('dCreate', new Date().format("dd.MM.yyyy").toString())
  </script>
</scriptTask>
```
где
**dCreate** - это поле в которое поместится результат (Время берется по Гринвичу)  
**format("dd.MM.yyyy")** - задаем формат получаемого времени. Если формат не указываем то  по умолчанию дата / время будут в формате Tue Apr 26 14:51:17 UTC 2016  
**toString()** - не обязательно, это перестраховка  

## Получение даты/времени напоминания о выбранной дате из электронной очереди
Пример использования  доступен в процессе dnepr_dms_passport  
Необходимо создать скрипт-таску. Указать язык javaScript  

```javaScript 
var src=execution.getVariable('date_of_visit')   //  получаем значение, выбранного времени из электронной очереди из зарезервированной переменной из date_of_visit

var year=src.substr(0,4)
var month=src.substr(5,2)
var day=src.substr(8,2)
var hour=src.substr(11,2)
var minutes=src.substr(14,2)
var seconds='00'
var delta=1 				//  задаем количество дней, за которое необходимо будет напомнить о визите
if (day!='01')				//  парсим полученную дату/время из date_of_visit
	{
    	day=day-delta
	}
else
	{
    	if ((month!='01')&&(month!='03'))
      	{
          	month=month-1
          	day=30
      	}
    	else
      	{
        	if (month=='03')
        	{
          	month='02'
          	day='28'
        	}       	 
      	}
 	}
var timer=year+'-'+month+'-'+day+'T'+hour+':'+minutes+':'+seconds //склеиваем строку в нужном формате

execution.setVariable('sNotification_day', timer)  //возвращаем в процесс итоговую переменную в нужном формате для таймера
```
**sNotification_day**  - это заранее созданная в процессе переменная, в которую вернем результат работы скрипта 

## Вычисление любой даты до (для напоминания) или после (для удаления заявки) даты визита:
```javaScript 
var src=execution.getVariable('date_of_visit');  //получаем значение, выбранного времени из электронной очереди из зарезервированной переменной из date_of_visit
//Парсим
var year=src.substr(0,4);
var month=src.substr(5,2);
var day=src.substr(8,2);
var hour=src.substr(11,2);
var minutes=src.substr(14,2);
var seconds='00';
var delta='10';//переменная, указывает на +\- сдвиг во времени (дни)
//Конвертируем в юникстайм
var date1 = year+'-'+month+'-'+day+' '+hour+':'+minutes+':'+seconds;
var date2 = Date.parse(date1)
var unixdate= date2/1000;
//Работаем с юникстаймом
var unixdate=unixdate+86400*delta; //умножаем на сколько нужно дней в секундах
//Конвертируем назад в дату
var new_src = new Date(unixdate*1000);
var d = new_src.getDate();
if (d < 10) d = "0"+d;
var m = new_src.getMonth();
var m = (+m + +1);
if (m < 10) m = "0"+m;

var new_year = new_src.getFullYear();
var new_hour = new_src.getHours();
var new_minutes = new_src.getMinutes();
var timer = new_year+'-'+m+'-'+d+'T'+new_hour+':'+new_minutes+':'+seconds;
execution.setVariable('sDelete_day', timer)
```
Текущую дату на момент срабатывания скрипта можно получить так:  
```javaScript 
var unixdate= Math.round((new Date()).getTime() / 1000);
```
## Удаление конкретного слота за продолжителный период
```javaScript 
var aDate=[
"2017-01-19"
,"2017-01-20"
,"2017-01-21"
,"2017-01-22"
,"2017-01-23"
    ];
for(n=0;n<aDate.length;n++){
    var tok = 'system' + ':' + 'system';
        hash = btoa(tok);
        authInfo = "Basic " + hash;
$.ajax({
    type: 'DELETE',
    url: 'https://delta.test.region.igov.org.ua/wf/service/action/flow/clearFlowSlots?nID_Flow_ServiceData=34&sDateStart='+aDate[n]+' 10:00:00.00&sDateStop='+aDate[n]+' 10:14:00.00',
    beforeSend: function (xhr) { xhr.setRequestHeader ("Authorization", authInfo); },
    crossDomain: true,
    dataType: 'json',
    
    success: function(result) {
        // Do something with the result
//  alert(result);
console.info("n="+n+",aDate[n]="+aDate[n]);
    }
});
}
alert("ok");
```
нужно зайти на регион сервера, с которого будет удаляться свободные слоты,  например  
https://delta.test.region.igov.org.ua  
открываем консоль F12 и туда вставляем, проверяем массив дат, свой логин/пароль  

***

## Формирование динамического списка документов (для принтформ)
```javaScript 
var per1 = "<li>Документ, що посвідчує особу (паспорт, свідоцтво про народження);</li>"
var per6 = " "
var per7 = " "
var res = 'res'
if(execution.getVariable('sDocPay') != null){
per6 = '<li>Квитанція про сплату державного мита;</li>'
}
if(execution.getVariable('sDocMarriage') != null){
per7 = '<li>Свідоцтво про шлюб;</li>'
}
res = '<ol>'+per1+per6+per7+'</ol>'
execution.setVariable('sListDocumentsPrint', res)
```
## Получение ИД текущего процесса
```javaScript 
var processInstanceId = execution.getProcessInstanceId();
execution.setVariable('processInstanceId', processInstanceId)
```
* ![16_2](https://github.com/e-government-ua/i/blob/test/doc/bp/img/16_2.JPG)

## Формирование динамического названия юзертаски
```javaScript 
var sUsertask1_name =""
if (execution.getVariable('asCategoryIncoming')=='sEnumCentralGov'){
sUsertask1_name="документ центральних органів влади"
}
if (execution.getVariable('asCategoryIncoming')=='sEnumActsRevision'){
sUsertask1_name="акт ревізії"
}
if (execution.getVariable('asCategoryIncoming')=='sEnumLogisticalSupport'){
sUsertask1_name="заявка на матеріально-технічне забезпечення"
}
execution.setVariable('sUsertask1_name', sUsertask1_name)
```

***

## Счетчик добавления номера в поле входящего номера
```javaScript 
var number=execution.getVariable('sID_Order_GovPublic')
var fullNumber="вх-"+number+"/"
execution.setVariable('sID_Order_GovPublic', fullNumber)
```
* ![16_3](https://github.com/e-government-ua/i/blob/test/doc/bp/img/16_3.JPG)
***

## Назначение даты исполнения - по умолчанию + 30 дней к текущей даты и перевод даты в нужный формат дд/мм/гггг
```javaScript 
var updatedDate = new Date();
var days = 30;
updatedDate.setDate(new Date().getDate() + days);
var d = updatedDate.getDate();
if (d < 10) d = "0"+d;
var m = updatedDate.getMonth() + 1;
if (m < 10) m = "0"+m;
var sNewDate = (d + "/" + m + "/" + updatedDate.getFullYear());
execution.setVariable('sDateExecution', sNewDate)
```

***

## Получение ИД БП
```javaScript 
var executeProcessDefinitionId = execution.getProcessDefinitionId();
var splittedProcessDefinitionId = executeProcessDefinitionId.split(':')[0];
execution.setVariable('processDefinitionId', splittedProcessDefinitionId)
```

***

## Получение логина и ФИО основного исполнителя (человека которого в таблице выбрали первым)
```javaScript 
var processInstanceId = execution.getVariable('processInstanceId');
var obj = processSubjectTreeService.getCatalogProcessSubjectTree(processInstanceId, 1, null, false, 1);
var sMainExecutor = " ";
var sFirstName = " ";
var sLastName = " ";

var i = 0;
do {
i++
} while (obj.aProcessSubjectTree[0].sLogin != obj.aProcessSubjectTree[0].aUser[i].sLogin)
execution.setVariable('sMainExecutor', obj.aProcessSubjectTree[0].aUser[i].sLogin)
execution.setVariable('sFirstName', obj.aProcessSubjectTree[0].aUser[i].sFirstName)
execution.setVariable('sLastName', obj.aProcessSubjectTree[0].aUser[i].sLastName)
var sExecutor = obj.aProcessSubjectTree[0].aUser[i].sFirstName + " " + obj.aProcessSubjectTree[0].aUser[i].sLastName
execution.setVariable('sExecutor', sExecutor)
```
* ![16_1](https://github.com/e-government-ua/i/blob/test/doc/bp/img/16_1.JPG)
***
